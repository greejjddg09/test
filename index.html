<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EduGPT ‚Äî –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</title>

  <!-- Google font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg: #0f0b16;
      --card: #10071a;
      --muted: #bdbcdc;
      --accent-1: #7c3aed;
      --accent-2: #6b21a8;
      --accent-3: linear-gradient(135deg,#7c3aed 0%,#5b21bf 100%);
      --glass: rgba(255,255,255,0.03);
      --radius: 14px;
      --shadow: 0 8px 30px rgba(11,7,25,0.6);
    }

    * { box-sizing: border-box; }
    html,body{ height:100%; margin:0; font-family:Inter,system-ui; background:var(--bg); color:#fff; }

    .app { max-width:1200px; margin:28px auto; display:grid; grid-template-columns: 1fr 360px; gap:24px; padding:0 20px; }
    header.topbar{ grid-column:1/-1; display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .brand { display:flex; gap:12px; align-items:center; }
    .logo { width:44px;height:44px;border-radius:10px;background:var(--accent-3);display:flex;align-items:center;justify-content:center;font-weight:800; }
    .title { font-size:18px;font-weight:700; }
    .subtitle { font-size:12px;color:var(--muted); }
    .actions { display:flex; gap:10px; align-items:center; }
    .btn { padding:8px 12px;border-radius:10px;font-weight:600;border:0;cursor:pointer;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));color:white; }
    .btn.ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); }
    .main { background:var(--glass); padding:18px;border-radius:var(--radius); min-height:640px; }
    .hero { display:flex; justify-content:space-between; gap:18px; margin-bottom:18px; }
    .h1 { font-size:20px;font-weight:800; margin:0 0 6px 0; }
    .lead { color:var(--muted); font-size:13px; }
    .courses { display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap:12px; margin-top:14px; }
    .card { background:var(--glass); border-radius:12px; padding:12px; }
    .course-title { font-weight:700; font-size:15px; }
    .meta { color:var(--muted); font-size:12px; }
    .lesson { margin-top:18px; padding:14px; background:var(--glass); border-radius:12px; }
    .chat { position:sticky; top:28px; background:var(--glass); padding:12px;border-radius:12px; min-height:300px; display:flex; flex-direction:column; gap:12px; }
    .chat .history { flex:1; overflow:auto; padding:8px; display:flex; flex-direction:column; gap:8px; }
    .msg { max-width:85%; padding:10px 12px; border-radius:12px; font-size:14px; line-height:1.4; }
    .msg.user { align-self:flex-end; background: rgba(124,58,237,0.12); }
    .msg.bot { align-self:flex-start; background: rgba(255,255,255,0.02); color:var(--muted); }
    .chat .composer { display:flex; gap:8px; }
    .chat input { flex:1; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:#fff; }
    .modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; padding:20px; z-index:60; }
    .modal { width:100%; max-width:720px; background:var(--glass); border-radius:14px; padding:18px; }
    @media(max-width:1000px){ .app{ grid-template-columns:1fr; padding-bottom:80px; } .chat{ position:relative; order:3;} }
  </style>
</head>
<body>

  <div class="app">
    <header class="topbar">
      <div class="brand">
        <div class="logo">EG</div>
        <div>
          <div class="title">EduGPT</div>
          <div class="subtitle">–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ ‚Äî –¶–µ–ª—å –û–û–ù ‚Ññ4</div>
        </div>
      </div>

      <div class="actions">
        <!-- Telegram widget -->
        <script async src="https://telegram.org/js/telegram-widget.js?22"
          data-telegram-login="mirzotilloyev_bot"
          data-size="large"
          data-onauth="onTelegramAuth(user)"
          data-request-access="write"></script>
        <button class="btn" id="create-course">–Ø —Ä–æ–¥–∏—Ç–µ–ª—å</button>
      </div>
    </header>

    <main class="main">
      <section class="hero">
        <div class="left">
          <h2 class="h1">–ö—É—Ä—Å—ã –ø–æ —Ü–∏—Ñ—Ä–æ–≤—ã–º –Ω–∞–≤—ã–∫–∞–º</h2>
          <p class="lead">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —É—Ä–æ–∫–∏, —Ç–µ—Å—Ç—ã –∏ –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ Telegram.</p>
        </div>
      </section>

      <section class="courses" id="courses"></section>
      <section class="lesson" id="lesson-area" style="display:none;">
        <h3 id="lesson-title">–£—Ä–æ–∫</h3>
        <p id="lesson-body" class="lead"></p>
        <div class="lesson-actions">
          <button class="btn" id="start-test">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç</button>
          <button class="btn ghost" id="back-to-courses">–ù–∞–∑–∞–¥ –∫ –∫—É—Ä—Å–∞–º</button>
        </div>
      </section>
    </main>

    <aside class="chat">
      <div><strong>AI-–ø–æ–º–æ—â–Ω–∏–∫</strong></div>
      <div class="history" id="chat-history"><div class="msg bot">–ü—Ä–∏–≤–µ—Ç! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å –ø–æ –∫—É—Ä—Å—É?</div></div>
      <div class="composer">
        <input id="chat-input" placeholder="–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å..." />
        <button class="btn" id="chat-send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
      </div>
    </aside>
  </div>

  <div class="modal-backdrop" id="modal">
    <div class="modal">
      <h3 id="test-title">–¢–µ—Å—Ç</h3>
      <div id="questions"></div>
      <div style="text-align:right; margin-top:12px;">
        <button class="btn ghost" id="close-test">–û—Ç–º–µ–Ω–∞</button>
        <button class="btn" id="submit-test">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ Telegram</button>
      </div>
    </div>
  </div>

  <script>
    /* ========== Telegram Auth ========== */
    function onTelegramAuth(user) {
      console.log("TG user:", user);
      localStorage.setItem("telegram_id", user.id);
      document.querySelector(".actions").innerHTML = `<span>–ü—Ä–∏–≤–µ—Ç, ${user.first_name} üëã</span>`;
    }

    /* Demo courses */
    /* ========== Demo data ========== */
const COURSES = [
  {
    id:1,
    title:'–í–≤–µ–¥–µ–Ω–∏–µ –≤ Python',
    description:'–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, –±–∞–∑–æ–≤—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å',
    lessons:[
      {id:11, title:'–ß—Ç–æ —Ç–∞–∫–æ–µ Python', body:'Python ‚Äî —ç—Ç–æ...'},
      {id:12, title:'–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ', body:'–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç...'}
    ],
    test: {
      title:'–¢–µ—Å—Ç: –æ—Å–Ω–æ–≤—ã Python',
      questions:[
        {id:1, q:'–ö–∞–∫–æ–π —Ç–∏–ø –≤ Python –¥–ª—è —Ü–µ–ª—ã—Ö —á–∏—Å–µ–ª?', options:['int','str','float'], answer:0},
        {id:2, q:'–ß—Ç–æ –≤—ã–≤–æ–¥–∏—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ print("Hi")?', options:['Hi','"Hi"','print("Hi")'], answer:0},
        {id:3, q:'–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è len("abc")?', options:['3','"abc"','–æ—à–∏–±–∫–∞'], answer:0}
      ]
    }
  },
  {
    id:2,
    title:'–í–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞',
    description:'HTML, CSS, –æ—Å–Ω–æ–≤—ã JS',
    lessons:[
      {id:21, title:'HTML –æ—Å–Ω–æ–≤—ã', body:'HTML ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü—ã...'},
      {id:22, title:'CSS —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è', body:'CSS –∑–∞–¥–∞–µ—Ç —Å—Ç–∏–ª—å –¥–ª—è HTML-—ç–ª–µ–º–µ–Ω—Ç–æ–≤...'}
    ],
    test: {
      title:'–¢–µ—Å—Ç: –æ—Å–Ω–æ–≤—ã –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏',
      questions:[
        {id:1, q:'–ö–∞–∫–æ–π —Ç–µ–≥ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å—Å—ã–ª–∫–∏?', options:['<a>','<link>','<href>'], answer:0},
        {id:2, q:'–ß—Ç–æ –¥–µ–ª–∞–µ—Ç CSS —Å–≤–æ–π—Å—Ç–≤–æ color?', options:['–ò–∑–º–µ–Ω—è–µ—Ç —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞','–ò–∑–º–µ–Ω—è–µ—Ç —Ñ–æ–Ω','–ò–∑–º–µ–Ω—è–µ—Ç —Ä–∞–∑–º–µ—Ä'], answer:0},
        {id:3, q:'–ì–¥–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript?', options:['–í –±—Ä–∞—É–∑–µ—Ä–µ','–í Word','–í Photoshop'], answer:0}
      ]
    }
  },
  {
    id:3,
    title:'–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ',
    description:'–í–≤–µ–¥–µ–Ω–∏–µ –≤ ML',
    lessons:[
      {id:31, title:'–ß—Ç–æ —Ç–∞–∫–æ–µ ML', body:'ML ‚Äî —ç—Ç–æ –æ–±–ª–∞—Å—Ç—å –ò–ò, –∫–æ—Ç–æ—Ä–∞—è –æ–±—É—á–∞–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –∑–∞–∫–æ–Ω–æ–º–µ—Ä–Ω–æ—Å—Ç–∏.'}
    ],
    test: {
      title:'–¢–µ—Å—Ç: –æ—Å–Ω–æ–≤—ã ML',
      questions:[
        {id:1, q:'–ß—Ç–æ —Ç–∞–∫–æ–µ –æ–±—É—á–∞—é—â–∞—è –≤—ã–±–æ—Ä–∫–∞?', options:['–î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –º–æ–¥–µ–ª–∏','–ü—Ä–æ–≥—Ä–∞–º–º–∞','–ê–ª–≥–æ—Ä–∏—Ç–º'], answer:0},
        {id:2, q:'–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –∑–∞–¥–∞—á–∞ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —á–∏—Å–µ–ª?', options:['–†–µ–≥—Ä–µ—Å—Å–∏—è','–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è','–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è'], answer:0},
        {id:3, q:'–ù–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏ –≤–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω—ã...', options:['–†–∞–±–æ—Ç–æ–π –º–æ–∑–≥–∞','–ú–∞—Ç–µ–º–∞—Ç–∏–∫–æ–π','–§–∏–∑–∏–∫–æ–π'], answer:0}
      ]
    }
  },
  {
    id:4,
    title:'–ê–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö',
    description:'–ë–∞–∑–æ–≤—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã',
    lessons:[
      {id:41, title:'–ß—Ç–æ —Ç–∞–∫–æ–µ –∞–ª–≥–æ—Ä–∏—Ç–º', body:'–ê–ª–≥–æ—Ä–∏—Ç–º ‚Äî —ç—Ç–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏.'},
      {id:42, title:'–ú–∞—Å—Å–∏–≤—ã –∏ —Å–ø–∏—Å–∫–∏', body:'–°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤.'}
    ],
    test: {
      title:'–¢–µ—Å—Ç: –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö',
      questions:[
        {id:1, q:'–ß—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É?', options:['–ú–∞—Å—Å–∏–≤','–°–ø–∏—Å–æ–∫','–û—á–µ—Ä–µ–¥—å'], answer:0},
        {id:2, q:'–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–µ–∫?', options:['LIFO','FIFO','Random'], answer:0},
        {id:3, q:'–ö–∞–∫–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ —Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –≤ —Å—Ä–µ–¥–Ω–µ–º?', options:['–ë—ã—Å—Ç—Ä–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞','–ü—É–∑—ã—Ä—å–∫–æ–≤–∞—è','–í—Å—Ç–∞–≤–∫–∞–º–∏'], answer:0}
      ]
    }
  },
  {
    id:5,
    title:'SQL –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö',
    description:'–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ SQL',
    lessons:[
      {id:51, title:'–ß—Ç–æ —Ç–∞–∫–æ–µ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö', body:'–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–ª–ª–µ–∫—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö.'}
    ],
    test: {
      title:'–¢–µ—Å—Ç: SQL –æ—Å–Ω–æ–≤—ã',
      questions:[
        {id:1, q:'–ö–∞–∫–æ–π SQL-–∑–∞–ø—Ä–æ—Å –≤—ã–≤–æ–¥–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã users?', options:['SELECT * FROM users;','SHOW users;','GET users;'], answer:0},
        {id:2, q:'–ö–∞–∫–æ–π –æ–ø–µ—Ä–∞—Ç–æ—Ä —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ?', options:['WHERE','FILTER','IF'], answer:0},
        {id:3, q:'–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–º–∞–Ω–¥–∞ INSERT?', options:['–î–æ–±–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ','–£–¥–∞–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ','–û–±–Ω–æ–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ'], answer:0}
      ]
    }
  }
];


    const coursesEl = document.getElementById('courses');
    function renderCourses(){
      COURSES.forEach(c=>{
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `<div class="course-title">${c.title}</div><div class="meta">${c.description}</div><button class="btn" data-course="${c.id}">–û—Ç–∫—Ä—ã—Ç—å</button>`;
        coursesEl.appendChild(div);
      });
    }
    renderCourses();

    let currentCourse=null;
    document.addEventListener('click',e=>{
      if(e.target.matches('[data-course]')) openCourse(Number(e.target.dataset.course));
    });

    function openCourse(id){
      const c=COURSES.find(x=>x.id===id);
      currentCourse=c;
      document.getElementById('lesson-title').textContent=c.lessons[0].title;
      document.getElementById('lesson-body').textContent=c.lessons[0].body;
      document.getElementById('lesson-area').style.display='block';
    }

    document.getElementById('back-to-courses').onclick=()=>{document.getElementById('lesson-area').style.display='none';};

    /* Test modal */
    document.getElementById('start-test').onclick=()=>{
      if(!currentCourse.test) return alert('–ù–µ—Ç —Ç–µ—Å—Ç–∞');
      const qwrap=document.getElementById('questions'); qwrap.innerHTML='';
      document.getElementById('test-title').textContent=currentCourse.test.title;
      currentCourse.test.questions.forEach((q,i)=>{
        const d=document.createElement('div');
        d.innerHTML=`<p>${i+1}. ${q.q}</p>`+q.options.map((o,j)=>`<label><input type="radio" name="q${q.id}" value="${j}"> ${o}</label>`).join('<br>');
        qwrap.appendChild(d);
      });
      document.getElementById('modal').style.display='flex';
    };
    document.getElementById('close-test').onclick=()=>document.getElementById('modal').style.display='none';

    document.getElementById('submit-test').onclick=async()=>{
      const t=currentCourse.test;
      const answers=t.questions.map(q=>({qid:q.id,choice:Number(document.querySelector(`input[name="q${q.id}"]:checked`)?.value),correct:q.answer}));
      const score=Math.round(answers.filter(a=>a.choice===a.correct).length/t.questions.length*100);
      const telegram_id=localStorage.getItem("telegram_id");
      try{
        await fetch('/api/send-test-result',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({courseId:currentCourse.id,testTitle:t.title,score,answers,telegram_id})});
        alert('–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram!');
      }catch(e){alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏');}
      document.getElementById('modal').style.display='none';
    };

    /* Chat */
    document.getElementById('chat-send').onclick=sendChat;
    async function sendChat(){
      const input=document.getElementById('chat-input'); const text=input.value.trim(); if(!text) return;
      appendMsg('user',text); input.value='';
      try{
        const r=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({messages:[{role:'user',content:text}]})});
        const d=await r.json(); appendMsg('bot',d.choices?.[0]?.message?.content ?? '–ù–µ—Ç –æ—Ç–≤–µ—Ç–∞');
      }catch(e){appendMsg('bot','–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');}
    }
    function appendMsg(kind,text){const d=document.createElement('div');d.className='msg '+kind;d.textContent=text;document.getElementById('chat-history').appendChild(d);}
  </script>
    <script src="test.js"></script>
</body>
</html>




